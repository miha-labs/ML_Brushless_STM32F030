/* -----------------------------------------------------------------------------
	include
----------------------------------------------------------------------------- */
#include	"PID.h"


/* -----------------------------------------------------------------------------
	Local Macro
----------------------------------------------------------------------------- */
#define	SAT_OUT	


/* -----------------------------------------------------------------------------
	Local Variable
----------------------------------------------------------------------------- */



/* -----------------------------------------------------------------------------
	local Structure
----------------------------------------------------------------------------- */



/* -----------------------------------------------------------------------------
	local function
----------------------------------------------------------------------------- */



/* -----------------------------------------------------------------------------
	private function
----------------------------------------------------------------------------- */



/* -----------------------------------------------------------------------------
	public function
----------------------------------------------------------------------------- */
int32_t	PID_Control(PID_t *pid)
{
	int16_t	prop	= pid->prop;
	int32_t	intg	= pid->intg;
	int16_t	diff	= pid->diff;
	int16_t	kp		= pid->kp;
	int16_t	ki		= pid->ki;
	int16_t	kd		= pid->kd;
	int32_t	ilim	= pid->ilim;

  /* P */
	int32_t	P		= kp * prop;

  /* I */
	intg = intg + prop;
	if( intg>ilim )	intg = ilim;
	if( intg<-ilim )	intg = -ilim;
	int32_t	I		= ki * intg;

  /* D */
	int32_t	D		= kd * ( prop - diff );

  /* Update static value */
	pid->intg = intg;
	pid->diff = prop;

	return ( P + I + D );
}


int16_t	PID_DeadBand(int16_t target, int16_t dead_band)
{
	if( target > 0 )
	{
		target -= dead_band;
		if(target < 0)		target = 0;
	}
	else
	{
		target += dead_band;
		if(target > 0)		target = 0;
	}

	return target;
}

